{% import "NumaDOASiteBundle::components.html.twig" as component %}
{% block content %}

    <div class="form-group">
        {{ form_label(form.stockNr, null, { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.stockNr, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    {#{{ component.listingFieldInput(form.VIN,"", "form-group","col-sm-9") }}#}
    <div class="form-group">
        {{ form_label(form.VIN) }}
        <div class="col-sm-4">
            {{ form_widget(form.VIN) }}
        </div>
        <button id="vin_submit_button" type="button" class="vin btn btn-success">Decode Vin</button>
    </div>
    <script>
        function firstToUpperCase( str ) {
            return str.substr(0, 1).toUpperCase() + str.substr(1);
        }
        $('#vin_submit_button').click(function(){
            vin = $('#numa_doaadminbundle_item_VIN').val();
            make = $('#numa_doaadminbundle_item_make');
            model = $('#numa_doaadminbundle_item_model');
            year = $('#numa_doaadminbundle_item_year');
            bodyStyle = $('#numa_doaadminbundle_item_bodyStyle');
            bodyDescription = $('#numa_doaadminbundle_item_bodyDescription');
            doors = $('#numa_doaadminbundle_item_doors');
            mpgCity = $('#numa_doaadminbundle_item_mpgCity');
            mpgHighway = $('#numa_doaadminbundle_item_mpgHighway');
            driveType = $('#numa_doaadminbundle_item_driveType');
            fuelType = $('#numa_doaadminbundle_item_fuelType');
            transmission = $('#numa_doaadminbundle_item_transmission');
            engine = $('#numa_doaadminbundle_item_engine');
            console.log(vin);
            $.ajax({
                type: "POST",
                url: "{{ path("decode_vin_api") }}",
                data: {vin:vin},
                success: function(data, textStatus, jqXHR)
                {
                    //console.log(jQuery.isEmptyObject(data.make));
                    if(!jQuery.isEmptyObject(data.make.name)) {
                        make.val(data.make.name);
                    }
                    if(!jQuery.isEmptyObject(data.model.name)) {
                        model.val(data.model.name);
                    }
                    if(!jQuery.isEmptyObject(data.years[0].year)) {
                        year.val(data.years[0].year);
                    }
                    if(!jQuery.isEmptyObject(data.MPG.city)) {
                        mpgCity.val(data.MPG.city);
                    }
                    if(!jQuery.isEmptyObject(data.MPG.highway)) {
                        mpgHighway.val(data.MPG.highway);
                    }
                    if(!jQuery.isEmptyObject(data.categories.market) && (data.categories.market == "Wagon" || data.categories.market == "Van" || data.categories.market == "Truck" || data.categories.market == "SUV" || data.categories.market == "Sedan" || data.categories.market == "Hatchback" || data.categories.market == "Crossover" || data.categories.market == "Coupe" || data.categories.market == "Convertible")) {
                        bodyStyle.val(data.categories.market);
                    }
                    else if(!jQuery.isEmptyObject(data.categories.vehicleType) && (data.categories.vehicleType == "Wagon" || data.categories.vehicleType == "Van" || data.categories.vehicleType == "Truck" || data.categories.vehicleType == "SUV" || data.categories.vehicleType == "Sedan" || data.categories.vehicleType == "Hatchback" || data.categories.vehicleType == "Crossover" || data.categories.vehicleType == "Coupe" || data.categories.vehicleType == "Convertible")) {
                        bodyStyle.val(data.categories.vehicleType);
                    }
                    else if(!jQuery.isEmptyObject(data.categories.vehicleStyle) && (data.categories.vehicleStyle == "Wagon" || data.categories.vehicleStyle == "Van" || data.categories.vehicleStyle == "Truck" || data.categories.vehicleStyle == "SUV" || data.categories.vehicleStyle == "Sedan" || data.categories.vehicleStyle == "Hatchback" || data.categories.vehicleStyle == "Crossover" || data.categories.vehicleStyle == "Coupe" || data.categories.vehicleStyle == "Convertible")) {
                        bodyStyle.val(data.categories.vehicleStyle);
                    }
                    if(!jQuery.isEmptyObject(data.categories.vehicleStyle)) {
                        bodyDescription.val(data.categories.vehicleStyle);
                    }
                    if(!jQuery.isEmptyObject(data.numOfDoors)) {
                        doors.val(data.numOfDoors);
                    }
                    if(!jQuery.isEmptyObject(data.drivenWheels)) {
                        driveType.val(firstToUpperCase(data.drivenWheels));
                    }
                    if(!jQuery.isEmptyObject(data.engine.type)) {
                        fuelType.val(firstToUpperCase(data.engine.type));
                    }
                    if(!jQuery.isEmptyObject(data.transmission.name)) {
                        transmission.val(data.transmission.name);
                    }
                    else if(!jQuery.isEmptyObject(data.transmission.transmissionType)) {
                        transmission.val(data.transmission.transmissionType);
                    }
                    if(!jQuery.isEmptyObject(data.engine.name)) {
                        engine.val(data.engine.name);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    alert("Error, wrong VIN!");
                }
            });
        });
    </script>
    <div class="form-group">
        {{ form_label(form.make, null, { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.make, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    {{ component.listingFieldInput(form.model,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.retail_price,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.price,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.mileage,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.trim,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.bodyStyle,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.bodyDescription,"", "form-group","col-sm-9") }}
    <div class="form-group">
        {{ form_label(form.exteriorColor, 'Exterior Color', { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.exteriorColor, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.interiorColor, 'Interior Color', { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.interiorColor, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.doors, null, { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.doors, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.engine, null, { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.engine, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.transmission, null, { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.transmission, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.fuelType, 'Fuel Type', { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.fuelType, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.driveType, 'Drive Type', { 'label_attr': {'class': 'col-sm-3'} }) }}
        <div class="col-sm-9">
            {{ form_widget(form.driveType, { 'attr': {'class': 'form-control'} }) }}
        </div>
    </div>
    {{ component.listingFieldInput(form.mpgCity,"", "form-group","col-sm-9") }}
    {{ component.listingFieldInput(form.mpgHighway,"", "form-group","col-sm-9") }}

    {{ component.listingFieldInput(form.iwNo,"", "form-group","col-sm-9") }}
{% endblock %}
