{% extends app.request.get('_dashboard')=='DMS'
? 'NumaDOADMSBundle::layout.html.twig'
: 'NumaDOAAdminBundle::layout.html.twig' %}
{% form_theme edit_form 'bootstrap_3_horizontal_layout.html.twig' %}
{% block content %}
<div class="container">
    <ul class="nav nav-tabs">
        <li role="presentation" class="active"><a data-toggle="tab" href="#details">Details</a></li>
        <li role="presentation"><a data-toggle="tab" href="#ads">Ads</a></li>
        {%  if(edit_form.component is not empty) %}
            <li role="presentation"><a data-toggle="tab" href="#web-content">Content</a></li>
        {% endif %}
    </ul>
    {{ form_start(edit_form) }}
    <div class="tab-content">

        <div id="details" class="tab-pane active">
            <h1>Page edit</h1>
            {{ form_start(edit_form) }}
            {{ form_row(edit_form.title) }}
            {{ form_row(edit_form.description) }}
            {{ form_row(edit_form.keywords) }}
            {{ form_row(edit_form.url) }}

        </div>
        <div id="ads" class="tab-pane">
            {% include 'NumaDOAModuleBundle:Page:pageAds.html.twig' %}
        </div>
        {%  if(edit_form.component is not empty) %}
        <div id="web-content" class="tab-pane">

            {% for component in edit_form.component %}
            <div class="page-component well">
                {#{{ form_row(component.name,{'attr':{'class':'col-md-3'}}) }}               #}
                {#{{ form_row(component.type) }}#}
                {#{{ form_row(component.value) }}#}
                <div class="row page-component-row">
                    {{ form_label(component.name,'Name', { 'label_attr': {'class': 'col-sm-2'} }) }}
                    {{ form_errors(component.name) }}
                    <div class="col-sm-2">
                        {{ form_widget(component.name, { 'attr': {'class': 'form-control'} }) }}
                    </div>
                    {{ form_label(component.type,'Type', { 'label_attr': {'class': 'col-sm-2'} }) }}
                    {{ form_errors(component.type) }}
                    <div class="col-sm-2">
                        {{ form_widget(component.type, { 'attr': {'class': 'form-control'} }) }}
                    </div>
                </div>
                <div class="row">
                {{ form_errors(component.value) }}
                <div class="col-sm-12">
                    {{ form_widget(component.value, { 'attr': {'class': 'form-control'} }) }}
                </div>
                </div>
            </div>
            {% endfor %}
            {#{% include 'NumaDOAModuleBundle:Page:pageContent.html.twig' %}#}
        </div>
        {% endif %}
    </div>

    </form>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Modal title</h4>

                </div>
                <div class="modal-body">
                    <div class="te"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <div class="clear"></div>
    <a href="{{ path('page') }}" class="btn btn-default" class="btn btn-primary">
        Back to the list
    </a>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <div class="clear"></div>
        {% if(app.request.get('_dashboard')=='DMS') %}
            <a href="{{ path('dms_page') }}" class="btn btn-default">
                Back to the list
            </a>
        {% else %}
            <a href="{{ path('page') }}" class="btn btn-default">
                Back to the list
            </a>
        {% endif %}
    <script>
        initAjaxForm();
        function initAjaxForm() {
            $('body').on('submit', '.ajaxForm', function (e) {
                e.preventDefault();
                var formData = new FormData($('form')[1]);
                $.ajax({
                            type: $(this).attr('method'),
                            url: $(this).attr('action'),
                            data: formData,
                            //data: formData,
                            //Options to tell jQuery not to process data or worry about content-type.
                            cache: false,
                            contentType: false,
                            processData: false,
                            //dataType:'json',
                        })
                        .done(function (data) {

                            if (typeof data.message !== 'undefined') {
                                $('#myModal').modal('hide')
                                reloadAds();
                            }
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {

                            if (typeof jqXHR.responseJSON !== 'undefined') {
                                if (jqXHR.responseJSON.hasOwnProperty('form')) {
                                    $('#form_body').html(jqXHR.responseJSON.form);
                                }

                                $('.form_error').html(jqXHR.responseJSON.message);

                            } else {
                                alert(errorThrown);
                            }

                        });
            });
        }

        function reloadAds() {
            $.ajax({
                        type: 'POST',
                        url: '{{ path('page_load_ads',{'id':entity.id}) }}',
                        //data:
                    })
                    .done(function (data) {
                        $('#ads').html(data);
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {

                    });
        }
        $("#myModal").on("show.bs.modal", function (e) {
            var link = $(e.relatedTarget);
            console.log(link.attr("hrefxxx"));
            $(this).find(".modal-body").load(link.attr("hrefxxx"));
        });
        $(function () {


            $(".ad-close").click(function (e) {
                e.preventDefault();
                console.log($(this).closest(".well").data("adid"));
                $.ajax({
                            type: 'POST',
                            url: '/admin/ads/' + $(this).closest(".well").data("adid") + '/delete',
                            //data:
                        })
                        .done(function (data) {
                            reloadAds();
                            //alert("AAAs");
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {

                        });
            })
        });
    </script>
    {% endblock %}
