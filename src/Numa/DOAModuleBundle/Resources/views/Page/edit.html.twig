{% extends 'NumaDOAAdminBundle::layout.html.twig' %}
{% form_theme edit_form 'bootstrap_3_horizontal_layout.html.twig' %}
{% block content %}
    <div class="container">
        <h1>Page edit</h1>
        {{ form(edit_form) }}


        <div id="ads">
            {% include 'NumaDOAModuleBundle:Page:pageAds.html.twig' %}
        </div>
        <!-- Button trigger modal -->



        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Modal title</h4>

                    </div>
                    <div class="modal-body"><div class="te"></div></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <div class="clear"></div>
    <a href="{{ path('page') }}" class="btn btn-default" class="btn btn-primary">
        Back to the list
    </a>
    <script>
        initAjaxForm();
        function initAjaxForm()
        {
            $('body').on('submit', '.ajaxForm', function (e) {
                e.preventDefault();
                var formData = new FormData($('form')[1]);
                alert("xxx");
                $.ajax({
                            type: $(this).attr('method'),
                            url: $(this).attr('action'),
                            data: formData,
                            //data: formData,
                            //Options to tell jQuery not to process data or worry about content-type.
                            cache: false,
                            contentType: false,
                            processData: false,
                            //dataType:'json',
                        })
                        .done(function (data) {

                            if (typeof data.message !== 'undefined') {
                                alert("aaaa");
                                $('#myModal').modal('hide')
                                reloadAds();
                            }
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {

                            if (typeof jqXHR.responseJSON !== 'undefined') {
                                if (jqXHR.responseJSON.hasOwnProperty('form')) {
                                    $('#form_body').html(jqXHR.responseJSON.form);
                                }

                                $('.form_error').html(jqXHR.responseJSON.message);

                            } else {
                                alert(errorThrown);
                            }

                        });
            });
        }

        function reloadAds(){
            $.ajax({
                        type: 'POST',
                        url: '{{ path('page_load_ads',{'id':entity.id}) }}',
                        //data:
                    })
                    .done(function (data) {
                        $('#ads').html(data);
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {

                    });
        }
        $("#myModal").on("show.bs.modal", function(e) {
            var link = $(e.relatedTarget);
            console.log(link.attr("hrefxxx"));
            $(this).find(".modal-body").load(link.attr("hrefxxx"));
        });
        $(function() {


            $(".ad-close").click(function(e){
                e.preventDefault();
                console.log($(this).closest(".well").data("adid"));
                $.ajax({
                            type: 'POST',
                            url: '/admin/ads/'+$(this).closest(".well").data("adid")+'/delete',
                            //data:
                        })
                        .done(function (data) {
                            reloadAds();
                            //alert("AAAs");
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {

                        });
            })
        });
    </script>
{% endblock %}
