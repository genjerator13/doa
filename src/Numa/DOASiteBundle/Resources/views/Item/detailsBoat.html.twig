{% extends 'NumaDOASiteBundle::home-layout.html.twig' %}

{% block content %}
    {% set images = item.getImages()%}
        {% set desc = item.getMake()~item.getModel()%}
            <div class="detailsContent">
                <h3>{{item.getItemFieldByName('year')}} {{desc}} <span class="price">{{item.getItemFieldByName('Price')|number_format(0, '.',',')}} $</span></h3>
                <div class="image-gallery">  
                    <div class="big-image">  

                        <img id="default" src="{{(images|first).stringvalue|imagine_filter('item_detail_image')}}" />
                    </div>  


                    <a href=""><span class=" glyphicon glyphicon-chevron-left"></span></a>
                    <a href="" class=" glyphicon glyphicon-chevron-right"></a>


                    <div class="thumbs">  
                        <ul>   
                            {% for key,image in images %}
                                <li>
                                    <a href="#image{{key}}"><img  src="{{image.stringvalue|imagine_filter('search_image')}}" alt="image{{key}}" /></a></li>
                                <li>
                                {% endfor %}
                        </ul>
                    </div>

                    <a href="#" class="showAllPictures">show all pictures</a>
                    <a href="#" class="viewSlideShow">view slideshow</a>

                </div>

                <ul class="techData">

                    <li>
                        <span class="fieldCaption fieldCaptionId">Listing #</span>
                        <span class="fieldValue fieldValueId">{{item.id}}</span>
                    </li>
                    {% set ignore_fields = ['Image List','dealer'] %}
                        {% for field in item.ItemField %}
                            {% if field.fieldName not in ignore_fields %}
                                <li>
                                    <span class="fieldCaption field{{field.fieldStringValue}}">{{field.fieldName}} </span>
                                    <span class="fieldValue fieldValue{{field.fieldStringValue}}">{{field.fieldStringValue}}</span>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                    <div id="map"> </div> 
                </div>
                {% endblock %}

                    {% block rightsidebar %}
                        {% if (dealer is not empty) %}
                            <h3>Dealer Info</h3>
                            {% if (dealer.logo is empty) %}
                                <img alt="logo" src="{{dealer.logoUrl}}" />
                            {% endif %}
                            <p><strong>{{dealer.name}}<strong/></p>
                            <p>{{dealer.address}}</p>
                            <p>{{dealer.phone}}</p>
                            <p>{{dealer.location}}</p>
                            <p>{{dealer.url}}</p>
                            <p>Send <a href="mailto:{{dealer.email}}" >email</a>
                            <p><a style="" href="{{ path('search_by_dealer',{'dealerid': dealer.id,'dealername': dealer.name}) }}">All adds by that dealser</a></p>

                        {% endif %}
                        <script src="https://maps.googleapis.com/maps/api/js"></script>
                        <script>
                            var geocoder = new google.maps.Geocoder();
                            var address = "{{dealer.address}}";
                            var latitude = 44.5403;
                            var longitude = -78.5463;
                            geocoder.geocode({'address': address}, function(results, status) {

                                if (status == google.maps.GeocoderStatus.OK) {
                                    latitude = results[0].geometry.location.lat();
                                    longitude = results[0].geometry.location.lng();

                                }
                            });
                            function initialize() {
                                var mapCanvas = document.getElementById('map');
                                var mapOptions = {
                                    center: new google.maps.LatLng(latitude, longitude),
                                    zoom: 13,
                                    mapTypeId: google.maps.MapTypeId.ROADMAP
                                }

                                var map = new google.maps.Map(mapCanvas, mapOptions)
                                var myLatlng = new google.maps.LatLng(latitude,longitude);
                                var marker = new google.maps.Marker({
                                    position: myLatlng,
                                    map: map,
                                    title: '{{dealer.name}}'
                                });

                            }
                            google.maps.event.addDomListener(window, 'load', initialize);
                        </script>

                    {% endblock %}